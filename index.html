<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elevents</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>🎉 Elevents</h1>
    <div class="search">
      <input type="text" id="searchCity" placeholder="Stadt">
      <input type="date" id="searchDate">
      <select id="searchType">
        <option value="">Alle Typen</option>
        <option value="Party">Party</option>
        <option value="Konzert">Konzert</option>
        <option value="Festival">Festival</option>
      </select>
      <button onclick="loadEvents()">🔍 Suchen</button>
    </div>
  </header>

  <main>
    <section id="events"></section>
  </main>

  <footer>
    <h2>Neues Event hinzufügen</h2>
    <form id="eventForm">
      <input type="text" id="title" placeholder="Titel" required>
      <input type="text" id="city" placeholder="Stadt" required>
      <input type="date" id="date" required>
      <input type="text" id="type" placeholder="Typ (Party, Konzert…)" required>
      <input type="text" id="img" placeholder="Bild-URL (optional)">
      <button type="submit">➕ Speichern</button>
    </form>
  </footer>

  <script>
    // 🔹 DEINE Web-App-URL hier einfügen:
    const API_URL = "https://script.google.com/macros/s/AKfycby0yAp4_LIkH_nLnnV1NxSVryI2CJ8o-r0aLx9zu_2xuAvLBNaHNZ5nhirqRuYffdrJMw/exec";

    // Events laden
    async function loadEvents() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();
        const events = data.slice(1).map(row => ({
          title: row[0],
          city: row[1],
          date: row[2],
          type: row[3],
          img: row[4]
        }));
        renderEvents(events);
      } catch (err) {
        console.error("Fehler beim Laden:", err);
      }
    }

    // Events anzeigen
    function renderEvents(events) {
      const container = document.getElementById("events");
      container.innerHTML = "";
      events.forEach(ev => {
        const card = document.createElement("div");
        card.className = "event-card";
        card.innerHTML = `
          <h3>${ev.title}</h3>
          <p>📍 ${ev.city}</p>
          <p>📅 ${ev.date}</p>
          <p>🎭 ${ev.type}</p>
          ${ev.img ? `<img src="${ev.img}" alt="${ev.title}" style="max-width:200px;">` : ""}
        `;
        container.appendChild(card);
      });
    }

    // Neues Event speichern
    async function saveEvent(event) {
      event.preventDefault();
      const newEvent = {
        title: document.getElementById("title").value,
        city: document.getElementById("city").value,
        date: document.getElementById("date").value,
        type: document.getElementById("type").value,
        img: document.getElementById("img").value
      };

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(newEvent)
        });
        const result = await res.json();
        console.log("POST Ergebnis:", result);
        document.getElementById("eventForm").reset();
        loadEvents();
      } catch (err) {
        console.error("Fehler beim Speichern:", err);
        alert("Event konnte nicht gespeichert werden!");
      }
    }

    document.getElementById("eventForm").addEventListener("submit", saveEvent);

    // Seite starten
    loadEvents();
  </script>
</body>
</html>
